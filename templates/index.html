<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image CHAT 图像工具</title>
    <!-- 引入 Google Fonts: Newsreader (衬线) 和 Inter (无衬线) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Newsreader:ital,wght@0,400;0,500;1,400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <h1>Image CHAT 图像工具</h1>
        
        <div class="api-key-section">
            <div class="input-group">
                <label for="providerSelector">选择服务商：</label>
                <select id="providerSelector">
                    <option value="google">Google</option>
                    <option value="openrouter">OpenRouter</option>
                    <option value="tuzi">兔子</option>
                </select>
            </div>
            <div class="input-group">
                <label for="apiKeyInput" id="apiKeyLabel">Google API Key：</label>
                <input type="password" id="apiKeyInput" placeholder="输入您的 Google Gemini API Key" required>
                <button onclick="saveApiKey()">保存</button>
                <button onclick="deleteApiKey()">清除</button>
                <span id="apiKeyStatus" class="status-text"></span>
            </div>
        </div>
        
        <div class="mode-section">
            <div class="input-group">
                <label>选择模式：</label>
                <div class="mode-tabs">
                    <button class="tab-btn active" onclick="switchMode('edit')">图像编辑</button>
                    <button class="tab-btn" onclick="switchMode('generate')">图像生成</button>
                </div>
            </div>
        </div>
        
        <div class="upload-section" id="editMode">
            <div class="input-group">
                <label for="imageInput">选择图片（可多选）：</label>
                <input type="file" id="imageInput" accept="image/*" multiple required>
                <div class="image-previews" id="editPreviews">
                    <p>请选择1张或多张图片进行编辑</p>
                </div>
            </div>
            
            <div class="input-group">
                <label for="instructionInput">编辑指令：</label>
                <textarea id="instructionInput" placeholder="例如：把天空变成夜晚，添加星星" required></textarea>
            </div>
            
            <div class="input-group">
                <label for="modelSelector">选择模型：</label>
                <select id="modelSelector">
                    <!-- 模型选项将通过JavaScript动态填充 -->
                </select>
            </div>
            
            <div class="input-group">
                <label for="temperatureSlider">模型温度 (Temperature)：<span id="temperatureValue">0.7</span></label>
                <input type="range" id="temperatureSlider" min="0.0" max="1.0" step="0.1" value="0.7">
            </div>
            
            <div class="input-group">
                <label for="editCountInput">生成数量：</label>
                <select id="editCountInput">
                    <option value="1">1张图片</option>
                    <option value="2">2张图片</option>
                    <option value="3">3张图片</option>
                    <option value="4">4张图片</option>
                </select>
            </div>
            
            <button id="editBtn" onclick="editImage()">开始编辑</button>
        </div>
        
        <div class="upload-section" id="generateMode" style="display: none;">
            <div class="input-group">
                <label for="descriptionInput">图像描述：</label>
                <textarea id="descriptionInput" placeholder="例如：一只可爱的小猫坐在花园里，阳光明媚，写实风格" required></textarea>
            </div>
            
            <div class="input-group">
                <label for="generateModelSelector">选择模型：</label>
                <select id="generateModelSelector">
                    <!-- 模型选项将通过JavaScript动态填充 -->
                </select>
            </div>
            
            <div class="input-group">
                <label for="generateTemperatureSlider">模型温度 (Temperature)：<span id="generateTemperatureValue">0.8</span></label>
                <input type="range" id="generateTemperatureSlider" min="0.0" max="1.0" step="0.1" value="0.8">
            </div>
            
            <div class="input-group">
                <label for="imageCountInput">生成数量：</label>
                <select id="imageCountInput">
                    <option value="1">1张图片</option>
                    <option value="2">2张图片</option>
                    <option value="3">3张图片</option>
                    <option value="4">4张图片</option>
                </select>
            </div>
            
            <button id="generateBtn" onclick="generateImage()">开始生成</button>
        </div>
        
        <div class="loading" id="loading" style="display: none;">
            <p>正在处理图片，请稍候...</p>
        </div>
        
        <div class="images-section" id="editResults">
            <div class="image-container">
                <h3>原图</h3>
                <div class="image-preview" id="originalPreview">
                    <p>请选择图片</p>
                </div>
            </div>
            
            <div class="image-container">
                <h3>编辑结果</h3>
                <div class="image-grid" id="editedImages">
                    <p>编辑完成后显示</p>
                </div>
                <button id="downloadEditBtn" onclick="downloadEditedImages()">下载所有图片</button>
            </div>
        </div>
        
        
        <div class="images-section" id="generateResults" style="display: none;">
            <div class="image-container full-width">
                <h3>生成结果</h3>
                <div class="image-grid" id="generatedImages">
                    <p>生成完成后显示</p>
                </div>
                <button id="downloadAllBtn" style="display: none;" onclick="downloadAllImages()">下载所有图片</button>
            </div>
        </div>
        
  
        <div class="error-message" id="errorMessage" style="display: none;"></div>
    </div>

    <!-- Image Modal for enlarged view -->
    <div id="imageModal" class="image-modal">
        <div class="image-modal-content">
            <button class="image-modal-close" onclick="closeImageModal()">&times;</button>
            <img id="modalImage" src="" alt="放大查看">
        </div>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>